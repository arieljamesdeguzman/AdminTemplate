@model IEnumerable<AdminTemplate.Models.Inventory>

<main id="main-content">
    <div class="content-wrapper">
        <div class="row">
            <div class="col-md-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h2>Inventory List</h2>
                        <a href="/Inventory/Create" class="btn btn-primary mb-3">Add New Item</a>

                        <div class="datatable-controls mb-3 d-flex justify-content-between align-items-center">
                            <div>
                                <input type="text" id="searchBox" placeholder="Search inventory..." class="datatable-search" />
                            </div>
                            <div>
                                <select id="rowsPerPage" class="datatable-select">
                                    <option value="5">5 rows</option>
                                    <option value="10" selected>10 rows</option>
                                    <option value="20">20 rows</option>
                                </select>
                            </div>
                        </div>

                        <table id="inventoryTable" class="table custom-datatable">
                            <thead>
                                <tr>
                                    <th data-sort="item">Item Name</th>
                                    <th data-sort="category">Category</th>
                                    <th data-sort="supplier">Supplier</th>
                                    <th data-sort="quantity">Quantity</th>
                                    <th data-sort="cost">Cost</th>
                                    <th data-sort="status">Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@item.ItemName</td>
                                        <td>@item.Category?.Name</td>
                                        <td>@item.Supplier?.SupplierName</td>
                                        <td>@item.CurrentQuantity @item.Unit</td>
                                        <td>@item.CostPerUnit.ToString("C")</td>
                                        <td>@item.Status</td>
                                        <td>
                                            <a href="/Inventory/Edit/@item.Id" class="btn btn-sm btn-warning">Edit</a>
                                            <a href="/Inventory/Details/@item.Id" class="btn btn-sm btn-info">Details</a>
                                            <a href="/Inventory/Delete/@item.Id" class="btn btn-sm btn-danger">Delete</a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                        <div class="datatable-footer d-flex justify-content-between align-items-center mt-3">
                            <div id="paginationInfo"></div>
                            <div id="paginationControls"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</main>


@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const table = document.getElementById("inventoryTable");
            const searchBox = document.getElementById("searchBox");
            const rowsPerPageSelect = document.getElementById("rowsPerPage");
            const paginationControls = document.getElementById("paginationControls");
            const paginationInfo = document.getElementById("paginationInfo");

            const rows = Array.from(table.querySelectorAll("tbody tr"));
            let currentPage = 1;
            let rowsPerPage = parseInt(rowsPerPageSelect.value);
            let filteredRows = [...rows];
            let currentSortColumn = null;
            let sortDirection = "asc";

            function renderTable() {
                rows.forEach(r => r.style.display = "none");

                const start = (currentPage - 1) * rowsPerPage;
                const end = start + rowsPerPage;

                filteredRows.slice(start, end).forEach(r => (r.style.display = ""));
                paginationInfo.textContent = `Showing ${start + 1}-${Math.min(end, filteredRows.length)} of ${filteredRows.length}`;
                renderPagination();
            }

            function renderPagination() {
                paginationControls.innerHTML = "";
                const pageCount = Math.ceil(filteredRows.length / rowsPerPage);

                for (let i = 1; i <= pageCount; i++) {
                    const btn = document.createElement("button");
                    btn.textContent = i;
                    btn.classList.toggle("active", i === currentPage);
                    btn.addEventListener("click", () => {
                        currentPage = i;
                        renderTable();
                    });
                    paginationControls.appendChild(btn);
                }
            }

            function filterRows() {
                const term = searchBox.value.toLowerCase();
                filteredRows = rows.filter(row =>
                    row.textContent.toLowerCase().includes(term)
                );
                currentPage = 1;
                renderTable();
            }

            function sortTable(columnIndex) {
                const header = table.querySelectorAll("th")[columnIndex];
                const isSameColumn = currentSortColumn === columnIndex;
                sortDirection = isSameColumn && sortDirection === "asc" ? "desc" : "asc";
                currentSortColumn = columnIndex;

                table.querySelectorAll("th").forEach(th => th.classList.remove("sort-asc", "sort-desc"));
                header.classList.add(sortDirection === "asc" ? "sort-asc" : "sort-desc");

                filteredRows.sort((a, b) => {
                    const textA = a.children[columnIndex].innerText.toLowerCase();
                    const textB = b.children[columnIndex].innerText.toLowerCase();
                    return sortDirection === "asc"
                        ? textA.localeCompare(textB, undefined, { numeric: true })
                        : textB.localeCompare(textA, undefined, { numeric: true });
                });

                renderTable();
            }

            searchBox.addEventListener("input", filterRows);
            rowsPerPageSelect.addEventListener("change", e => {
                rowsPerPage = parseInt(e.target.value);
                currentPage = 1;
                renderTable();
            });

            table.querySelectorAll("th").forEach((th, i) => {
                if (i < table.querySelectorAll("th").length - 1) {
                    th.addEventListener("click", () => sortTable(i));
                }
            });

            renderTable();
        });

    </script>
}


<style>
    .datatable-search {
        background-color: #2a2d32;
        color: #fff;
        border: 1px solid #555;
        border-radius: 6px;
        padding: 8px 12px;
        width: 220px;
        transition: border-color 0.2s ease;
    }

        .datatable-search:focus {
            border-color: #42a5f5;
            outline: none;
        }

    .datatable-select {
        background-color: #2a2d32;
        color: #fff;
        border: 1px solid #555;
        border-radius: 6px;
        padding: 6px;
    }

    .custom-datatable {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 6px;
    }

        .custom-datatable thead tr {
            background-color: #2c2f33;
            color: #fff;
        }

        .custom-datatable th {
            padding: 12px 16px;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

            .custom-datatable th.sort-asc::after {
                content: "▲";
                position: absolute;
                right: 8px;
                font-size: 0.7rem;
            }

            .custom-datatable th.sort-desc::after {
                content: "▼";
                position: absolute;
                right: 8px;
                font-size: 0.7rem;
            }

        .custom-datatable tbody tr {
            background-color: #1e2124;
            transition: 0.2s;
        }

            .custom-datatable tbody tr:hover {
                background-color: #2a2d32;
            }

        .custom-datatable td {
            padding: 12px 16px;
            color: #ddd;
        }

    .datatable-footer {
        color: #aaa;
        font-size: 0.9rem;
    }

    #paginationControls button {
        background: #2a2d32;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 6px 10px;
        margin: 0 3px;
        transition: background 0.2s;
    }

        #paginationControls button:hover {
            background: #42a5f5;
        }

        #paginationControls button.active {
            background: #42a5f5;
            font-weight: 600;
        }
</style>